New Radio Tutorial
==================

Goals
-----

This tutorials includes simulation examples that are intended to provide
hints about the basic configurations of 5G NR networks.

.. versionadded:: 1.2.2

Source files location: `showcases/NR/standalone <https://github.com/Unipisa/Simu5G/tree/master/showcases/NR/standalone>`__


Introduction
------------

In this tutorial the :ini:`omnetpp.ini` file is composed of several sections, each of which extends the scenario provided
by the previous one. This way, the beginner user is provided with a step-by-step guide towards
scenarios with increasing complexities.

All the configurations use the :ned:`SingleCell_Standalone` network that can be found in the
:file:`simulations/NR/networks` folder.

.. literalinclude:: ../../../simulations/NR/networks/SingleCell_Standalone.ned
    :language: ned
    :start-at: SingleCell_Standalone

.. figure:: media/SingleCell_Standalone.png

    Initial configuration of the network

Step 1: Single UE
-----------------

Configuration: :ini:`Single-UE`

This simple scenario simulates only one *UE* attached to one *gNB*, with downlink traffic. The UE is
located 400 meters far from the *gNB* and receives 800 kbps CBR traffic from a remote server.

.. literalinclude:: ../omnetpp.ini
    :language: ini
    :start-at: [Config Single-UE]
    :end-before: # ----
    :emphasize-lines: 8,22-23,28-30

Since this scenario does not include any inter-cell interference and the *gNB* is lightly loaded
(it is serving one *UE* only), you will observe that the throughput received by the *UE* is equal
to the throughput generated by the server.
See ``cbrReceivedThroughput:mean`` and ``cbrGeneratedThroughput:mean`` statistics.

Step 2: Adding Inter-Cell Interference
--------------------------------------

Configuration: :ini:`BgTraffic`

As a next step, let's add some inter-cell interference to the previous configuration. To do this,
the scenario simulates one background cell, which serves 10 background UEs. Each background UEs
receives 800 kbps CBR traffic.

.. note::
    
    Background cells/UEs are simplified models of cells/UEs and have the only purpose to create
    interference on foreground cells/UEs. See the following paper for more information:

       G. Nardini, G. Stea, A. Virdis, "Scalable Real-time Emulation of 5G Networks with Simu5G",
       IEEE Access, vol. 9, pp. 148504-148520, 2021. doi: 10.1109/ACCESS.2021.3123873.

.. literalinclude:: ../omnetpp.ini
    :language: ini
    :start-at: [Config BgTraffic]
    :end-before: # ----
    :emphasize-lines: 5

Due to the presence of interference you will observe smaller CQI for the foreground UE, as well as higher
number of allocated Resource Blocks in the downlink of the foreground cell.
See ``averageCqiDl:mean`` and ``avgServerBlocksDl:mean`` statistics.


Step 3: Adding a Variable Number of UEs
---------------------------------------

Configuration: :ini:`Multiple-UEs`

This configuration adds a variable number of (foreground) *UEs* (from 1 to 20) in the (foreground) *gNB*.
All of them receive 800 kbps CBR traffic from a remote server.

.. literalinclude:: ../omnetpp.ini
    :language: ini
    :start-at: [Config Multiple-UEs]
    :end-before: # ----
    :emphasize-lines: 5,12

Due to the increased offered load, you will observe higher number of allocated Resource Blocks in the
downlink of the foreground cell. In particular, you will observe that the allocated RBs will reach the
maximum number of available RBs in this scenario (6). As a consequence, some UEs will experience a lower
throughput than the throughput generated at the server.
See ``avgServerBlocksDl:mean`` and ``cbrReceivedThroughput:mean`` statistics.


Step 4: Carrier Aggregation
---------------------------

Configuration: :ini:`CarrierAggregation`

This configuration enables a second Component Carrier (CC) at the *gNBs*. Thus, the *UEs* will be allocated
into the second CC when the RBs in the first one are terminated.

.. literalinclude:: ../omnetpp.ini
    :language: ini
    :start-at: [Config CarrierAggregation]
    :end-before: # ----
    :emphasize-lines: 5,11,15,20

Due to the higher radio capacity available, you will observe higher number of allocated Resource Blocks in the
downlink of the foreground cell, but you will also observe that UEs will get higher throughput than the
previous scenario.
See ``avgServerBlocksDl:mean`` and ``cbrReceivedThroughput:mean`` statistics.


Step 5: Numerology
------------------

Configuration: :ini:`Numerology`

This configuration shows how to change the numerology (u=0,1,2) assigned to all Component Carriers (CC).

.. literalinclude:: ../omnetpp.ini
    :language: ini
    :start-at: [Config Numerology]
    :end-before: # ----
    :emphasize-lines: 5,6

When numerology increases, you will observe that the number of allocated Resource Blocks will decrease and
more UEs will get higher throughput.
See ``avgServerBlocksDl:mean`` and ``cbrReceivedThroughput:mean`` statistics.


Sources: :download:`omnetpp.ini <../omnetpp.ini>`, :download:`SingleCell_Standalone.ned <../../../simulations/NR/networks/SingleCell_Standalone.ned>`

Discussion
----------

Use `this page <https://github.com/Unipisa/Simu5G/discussions/TODO`__ in
the GitHub issue tracker for commenting on this showcase.
